"use strict";(()=>{var e={};e.id=285,e.ids=[285],e.modules={56:e=>{e.exports=require("@uniswap/v3-sdk")},288:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{F:()=>d,o:()=>c});var n=r(9527),i=r(8663),o=r(56),s=r(6493),l=e([n]);n=(l.then?(await l)():l)[0];let p=i.default||i;function u(e,t,r,a){return BigInt(e.toLowerCase())<BigInt(t.toLowerCase())?{token0:e,token1:t,amount0Desired:r,amount1Desired:a}:{token0:t,token1:e,amount0Desired:a,amount1Desired:r}}async function d(e,t,r,a,i){if(!s.bF)throw Error("POSITION_MANAGER_ADDRESS is not set");let l=u(t,r,"0","0"),d=l.token0===t?i:1/i,c=new n.Contract(s.bF,p,e),h=(0,o.encodeSqrtRatioX96)(Math.floor(1e6*d).toString(),"1000000"),g=function(e){let t=e.toString(16);return"0x"+t.padStart(32,"0")}(h);try{let e=await c.createAndInitializePoolIfNecessary(l.token0,l.token1,a,g);await e.wait()}catch(t){let e=t?.message??"";if(e.includes("already")&&(e.includes("initialized")||e.includes("exists")))return;throw t}}async function c(e,t,r,a,i,o,l,d,c){let h=u(t,r,l,d),g=h.token0===t?i:-o,m=h.token0===t?o:-i;if(!s.bF)throw Error("POSITION_MANAGER_ADDRESS is not set");let f=new n.Contract(s.bF,p,e),S=await e.provider?.getBlock("latest"),w=S?.timestamp??Math.floor(Date.now()/1e3),x=BigInt(h.amount0Desired)*BigInt(1e3-10*c)/BigInt(1e3),y=BigInt(h.amount1Desired)*BigInt(1e3-10*c)/BigInt(1e3),k=await e.getAddress(),v={token0:h.token0,token1:h.token1,fee:a,tickLower:g,tickUpper:m,amount0Desired:h.amount0Desired,amount1Desired:h.amount1Desired,amount0Min:x.toString(),amount1Min:y.toString(),recipient:k,deadline:w+600};try{await f.mint.staticCall(v)}catch(t){let e=t?.shortMessage||t?.message||String(t);if(e.includes("missing revert data"))console.warn("mint.staticCall failed with missing revert data, proceeding");else throw Error(e)}return await f.mint(v)}a()}catch(e){a(e)}})},361:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},491:e=>{e.exports=JSON.parse('[{"constant":false,"inputs":[{"name":"_spender","type":"address"},{"name":"_value","type":"uint256"}],"name":"approve","outputs":[{"name":"","type":"bool"}],"type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"name":"","type":"uint8"}],"type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"type":"function"}]')},2015:e=>{e.exports=require("react")},2326:e=>{e.exports=require("react-dom")},2758:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{E:()=>s});var n=r(9527),i=r(6493),o=e([n]);n=(o.then?(await o)():o)[0];let l=["function getPool(address tokenA, address tokenB, uint24 fee) external view returns (address)"];async function s(e,t,r){if(!i.Mo)throw Error("UNISWAP_V3_FACTORY_ADDRESS is not set");let a=new n.ethers.Contract(i.Mo,l,e),o=[500,3e3,1e4],s=[];for(let e of r)if(e.address.toLowerCase()!==t.toLowerCase())for(let r of o){let i=await a.getPool(t,e.address,r);i&&i!==n.ethers.ZeroAddress&&s.push({token:e,fee:r,pool:i})}return s}a()}catch(e){a(e)}})},3779:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{A:()=>g});var n=r(8732),i=r(2015),o=r(3720),s=r(5954),l=r(288),u=r(9527),d=r(491),c=r(7970),p=r(6493),h=e([s,l,u]);function g({provider:e}){let[t,r]=(0,i.useState)(""),[a,h]=(0,i.useState)(""),[g,m]=(0,i.useState)(""),[f,S]=(0,i.useState)(""),[w,x]=(0,i.useState)("0.95"),[y,k]=(0,i.useState)("1.05"),[v,b]=(0,i.useState)(""),{poolFee:j,setPoolFee:A,slippage:M,setSlippage:P}=(0,o.A)(),q=async r=>{r.preventDefault();try{if(!p.bF)throw Error("POSITION_MANAGER_ADDRESS is not set");if(!g||isNaN(Number(g))||0>=Number(g))throw Error("Amount Token0 must be a valid number greater than 0");if(!f||isNaN(Number(f))||0>=Number(f))throw Error("Amount Token1 must be a valid number greater than 0");b("Approving token0..."),await (0,s.$)(e,t,p.bF,g),b("Approving token1..."),await (0,s.$)(e,a,p.bF,f);let r=await e.getSigner(),n=new u.ethers.Contract(t,d,r),i=new u.ethers.Contract(a,d,r),o=await n.decimals(),h=await i.decimals(),m=(0,c.L)(parseFloat(w)),S=(0,c.L)(parseFloat(y)),x=(0,c.Y)(m,j),k=(0,c.Y)(S,j),v=(parseFloat(w)+parseFloat(y))/2;if(x>=k)throw Error("Invalid price range: Min price must be less than Max price");b(`tickLower=${x}, tickUpper=${k}`),b("Initializing pool if needed..."),await (0,l.F)(r,t,a,j,v);let A=u.ethers.parseUnits(g,o).toString(),P=u.ethers.parseUnits(f,h).toString();console.log("parsedAmount0:",A),console.log("parsedAmount1:",P),console.log("tickLower:",x,"tickUpper:",k);let q=await (0,l.o)(r,t,a,j,x,k,A,P,M);b("Transaction pending, waiting for confirmation...");try{await q.wait(),b("✅ Success!")}catch(t){console.error(t);let e=t?.shortMessage||t?.message||String(t);b("❌ Error while waiting for confirmation: "+e);return}}catch(t){console.error(t);let e=t?.shortMessage||t?.message||String(t);b("❌ Error: "+e)}};return(0,n.jsxs)("form",{onSubmit:q,children:[(0,n.jsx)("h2",{children:"Add Liquidity"}),(0,n.jsx)("input",{type:"text",placeholder:"Token0 address",value:t,onChange:e=>r(e.target.value),required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Token1 address",value:a,onChange:e=>h(e.target.value),required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Amount Token0",value:g,onChange:e=>m(e.target.value),required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Amount Token1",value:f,onChange:e=>S(e.target.value),required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Min price (ex: 0.95)",value:w,onChange:e=>x(e.target.value),required:!0}),(0,n.jsx)("input",{type:"text",placeholder:"Max price (ex: 1.05)",value:y,onChange:e=>k(e.target.value),required:!0}),(0,n.jsx)("input",{type:"number",placeholder:"Pool fee",value:j,onChange:e=>A(Number(e.target.value))}),(0,n.jsx)("input",{type:"number",placeholder:"Slippage (%)",step:"0.1",value:M,onChange:e=>P(Number(e.target.value))}),(0,n.jsx)("button",{type:"submit",children:"Add Liquidity"}),(0,n.jsx)("p",{children:v})]})}[s,l,u]=h.then?(await h)():h,a()}catch(e){a(e)}})},3873:e=>{e.exports=require("path")},4075:e=>{e.exports=require("zlib")},5954:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{$:()=>s});var n=r(9527),i=r(491),o=e([n]);async function s(e,t,r,a){let o=await e.getSigner(),s=new n.ethers.Contract(t,i,o),l=await s.decimals(),u=n.ethers.parseUnits(a,l);return(await s.approve(r,u)).wait()}n=(o.then?(await o)():o)[0],a()}catch(e){a(e)}})},7910:e=>{e.exports=require("stream")},7970:(e,t,r)=>{r.d(t,{L:()=>o,Y:()=>i});var a=r(56);let n={100:1,500:10,3e3:60,1e4:200};function i(e,t){let r=n[t]??1;return Math.floor(e/r)*r}function o(e){let t=(0,a.encodeSqrtRatioX96)(Math.floor(1e6*e).toString(),"1000000");return a.TickMath.getTickAtSqrtRatio(t)}},8241:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>S});var n=r(8732),i=r(2015),o=r(9918),s=r.n(o),l=r(3779),u=r(9527),d=r(8663),c=r(6493),p=r(1322),h=r(2758),g=r(1131),m=r(1617),f=e([l,u,p,h]);function S(){let[e,t]=(0,i.useState)(null),[r,a]=(0,i.useState)([]),{tokens:o}=(0,g.c)(),{pools:f,addPool:S}=(0,m.T)(),[w,x]=(0,i.useState)(""),[y,k]=(0,i.useState)([]),[v,b]=(0,i.useState)(!1),j=async(t,r)=>{if(!e)return;let n=await e.getSigner();if(await (0,p.H)(n,t,r),!c.bF)throw Error("POSITION_MANAGER_ADDRESS is not set");let i=new u.ethers.Contract(c.bF,d,e),o=await n.getAddress(),s=await i.balanceOf(o),l=[];for(let e=0;e<Number(s);e++){let t=await i.tokenOfOwnerByIndex(o,e),r=await i.positions(t);l.push({tokenId:Number(t),liquidity:r.liquidity.toString(),token0:r.token0,token1:r.token1})}a(l)},A=async t=>{if(t.preventDefault(),e){if(!u.ethers.isAddress(w))return void k([]);b(!0);try{let t=await (0,h.E)(e,w,o);k(t),t.forEach(e=>{S({token0:w,token1:e.token.address,fee:e.fee,pool:e.pool})})}catch(e){k([])}finally{b(!1)}}};return(0,n.jsxs)("main",{style:{padding:20},children:[(0,n.jsx)("h1",{children:"Pools"}),r.length>0&&(0,n.jsxs)("div",{children:[(0,n.jsx)("h2",{children:"Your Positions"}),(0,n.jsx)("ul",{children:r.map(e=>(0,n.jsxs)("li",{style:{marginBottom:10},children:["ID: ",e.tokenId," - ",e.token0,"/",e.token1," - Liquidity: ",e.liquidity,(0,n.jsx)("button",{style:{marginLeft:10},onClick:()=>j(e.tokenId,e.liquidity),children:"Remove"})]},e.tokenId))})]}),(0,n.jsx)("p",{style:{marginTop:20},children:"Add Liquidity"}),e?(0,n.jsx)(l.A,{provider:e}):(0,n.jsx)("p",{children:"\uD83E\uDD8A MetaMask に接続してください。"}),(0,n.jsxs)("div",{style:{marginTop:30},children:[(0,n.jsx)("h2",{children:"Find Pools"}),(0,n.jsxs)("form",{onSubmit:A,style:{marginBottom:10},children:[(0,n.jsx)("input",{type:"text",placeholder:"ERC20 address",value:w,onChange:e=>x(e.target.value),style:{marginRight:10}}),(0,n.jsx)("button",{type:"submit",children:"Search"})]}),v&&(0,n.jsx)("p",{children:"Searching..."}),y.length>0?(0,n.jsx)("ul",{children:y.map((e,t)=>(0,n.jsxs)("li",{children:[w," / ",e.token.symbol," (fee ",e.fee,") - ",e.pool]},t))}):!v&&w&&(0,n.jsx)("p",{children:"No pools found"})]}),f.length>0&&(0,n.jsxs)("div",{style:{marginTop:30},children:[(0,n.jsx)("h2",{children:"Known Pools"}),(0,n.jsx)("ul",{children:f.map((e,t)=>(0,n.jsxs)("li",{children:[e.token0,"/",e.token1," (fee ",e.fee,") - ",e.pool]},t))})]}),(0,n.jsx)("br",{}),(0,n.jsx)(s(),{href:"/swap",children:"← Back to Swap"})]})}[l,u,p,h]=f.then?(await f)():f,a()}catch(e){a(e)}})},8732:e=>{e.exports=require("react/jsx-runtime")},8751:e=>{e.exports=require("next-i18next")},9021:e=>{e.exports=require("fs")},9419:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>m,default:()=>c,getServerSideProps:()=>g,getStaticPaths:()=>h,getStaticProps:()=>p,reportWebVitals:()=>f,routeModule:()=>v,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>k,unstable_getStaticParams:()=>x,unstable_getStaticPaths:()=>w,unstable_getStaticProps:()=>S});var n=r(3885),i=r(237),o=r(1413),s=r(8874),l=r(2386),u=r(8241),d=e([l,u]);[l,u]=d.then?(await d)():d;let c=(0,o.M)(u,"default"),p=(0,o.M)(u,"getStaticProps"),h=(0,o.M)(u,"getStaticPaths"),g=(0,o.M)(u,"getServerSideProps"),m=(0,o.M)(u,"config"),f=(0,o.M)(u,"reportWebVitals"),S=(0,o.M)(u,"unstable_getStaticProps"),w=(0,o.M)(u,"unstable_getStaticPaths"),x=(0,o.M)(u,"unstable_getStaticParams"),y=(0,o.M)(u,"unstable_getServerProps"),k=(0,o.M)(u,"unstable_getServerSideProps"),v=new n.PagesRouteModule({definition:{kind:i.A.PAGES,page:"/pools",pathname:"/pools",bundlePath:"",filename:""},components:{App:l.default,Document:s.default},userland:u});a()}catch(e){a(e)}})},9527:e=>{e.exports=import("ethers")}};var t=require("../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[89,124,341,697],()=>r(9419));module.exports=a})();